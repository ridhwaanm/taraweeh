---
import Layout from "../layouts/Layout.astro";
import OttomanRecordingsPlayer from "../components/OttomanRecordingsPlayer";
import { getRecordings, getHuffadh, getVenues } from "../lib/db";
import type { RecordingWithDetails, Hafidh, Venue } from "../lib/db";

const recordings = (await getRecordings.all()) as RecordingWithDetails[];
const huffadhData = (await getHuffadh.all()) as Hafidh[];
const venuesData = (await getVenues.all()) as Venue[];

const huffadh = huffadhData.map((h) => h.name);
const venues = venuesData.map((v) => v.name);
const cities = [...new Set(venuesData.map((v) => v.city))];
const years = [...new Set(recordings.map((r) => r.hijri_year))].sort(
    (a, b) => b - a,
);
---

<Layout title="Taraweeh Recordings - مكتبة تسجيلات التراويح">
    <OttomanRecordingsPlayer
        recordings={recordings}
        huffadh={huffadh}
        venues={venues}
        cities={cities}
        years={years}
        client:load
    />
</Layout>
